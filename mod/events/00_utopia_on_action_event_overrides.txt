namespace = utopia

# Mind over Matter
country_event = {
	id = utopia.2600
	title = utopia.2600.name
	desc = utopia.2600.desc
	picture = GFX_evt_psionics
	show_sound = event_mind_over_matter
	is_triggered_only = yes
	immediate = {
		if = {
			limit = { any_owned_pop = { is_exact_same_species = ROOT } }
			random_owned_pop = {
				limit = { is_exact_same_species = ROOT }
				save_event_target_as = new_main_species_pop
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = ROOT
					NOR = {
						has_trait = trait_latent_psionic
						has_trait = trait_psionic
					}
				}
				save_event_target_as = new_main_species_pop
			}
		}
		every_galaxy_species = {
			limit = {
				is_same_species = ROOT
				is_organic_species = yes
				NOR = {
					has_trait = trait_latent_psionic
					has_trait = trait_psionic
				}
			}
			modify_species = {
				species = THIS
				add_trait = trait_latent_psionic
				change_scoped_species = no
			}
			every_country = {
				if = {
					limit = { any_owned_pop = { is_same_species = event_target:non_psionic_species } }
					every_owned_pop_species = {
						save_event_target_as = non_psionic_species
						modify_species = {
							species = THIS
							add_trait = trait_latent_psionic
							effect = {
								save_event_target_as = latent_psionic_species
							}
						}
						PREV = {
							every_owned_army = {
								limit = {
									exists = species
									species = { is_exact_same_species = event_target:non_psionic_species }
								}
								change_species = event_target:latent_psionic_species
							}
							every_owned_ship = {
								limit = {
									is_ship_class = shipclass_colonizer
									species = { is_exact_same_species = event_target:non_psionic_species }
								}
								change_species = event_target:latent_psionic_species
							}
							every_owned_leader = {
								limit = { is_exact_same_species = event_target:non_psionic_species }
								change_species = event_target:latent_psionic_species
								fire_on_action = { on_action = on_leader_species_changed }
							}
							every_pool_leader = {
								limit = { is_exact_same_species = event_target:non_psionic_species }
								change_species = event_target:latent_psionic_species
								fire_on_action = { on_action = on_leader_species_changed }
							}
						}
					}
				}
			}
		}
		change_dominant_species = { species = event_target:new_main_species_pop.species }
		observer_event = { id = observer.5 }
		every_country = {
			limit = {
				is_ai = no
				has_communications = ROOT
				NOT = { is_same_value = ROOT }
			}
			country_event = { id = utopia.2602 }
		}
	}

	option = {
		name = utopia.2600.a
		tooltip = {
			modify_species = {
				species = THIS
				add_trait = trait_latent_psionic
			}
		}
		custom_tooltip = ALLOW_PSI_CORPS
		custom_tooltip = ALLOW_PSI_ARMIES
	}
}

# Transcendence
country_event = {
	id = utopia.2650
	title = utopia.2650.name
	desc = utopia.2650.desc
	picture = GFX_evt_psionics
	show_sound = event_the_great_awakening
	is_triggered_only = yes
	immediate = {
		if = {
			limit = { any_owned_pop = { is_exact_same_species = ROOT } }
			random_owned_pop = {
				limit = { is_exact_same_species = ROOT }
				save_event_target_as = new_main_species_pop
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					is_same_species = ROOT
					NOT = { has_trait = trait_psionic }
				}
				save_event_target_as = new_main_species_pop
			}
		}
		every_galaxy_species = {
			limit = {
				is_same_species = ROOT
				is_organic_species = yes
				NOT = { has_trait = trait_psionic }
			}
			modify_species = {
				species = THIS
				add_trait = trait_psionic
				change_scoped_species = no
			}
			every_country = {
				if = {
					limit = { any_owned_pop = { is_same_species = event_target:non_psionic_species } }
					every_owned_pop_species = {
						save_event_target_as = non_psionic_species
						modify_species = {
							species = THIS
							add_trait = trait_psionic
							effect = {
								save_event_target_as = psionic_species
							}
						}
						PREV = {
							every_owned_army = {
								limit = {
									exists = species
									species = { is_exact_same_species = event_target:non_psionic_species }
								}
								change_species = event_target:psionic_species
							}
							every_owned_ship = {
								limit = {
									is_ship_class = shipclass_colonizer
									species = { is_exact_same_species = event_target:non_psionic_species }
								}
								change_species = event_target:psionic_species
							}
							every_owned_leader = {
								limit = { is_exact_same_species = event_target:non_psionic_species }
								change_species = event_target:psionic_species
								fire_on_action = { on_action = on_leader_species_changed }
							}
							every_pool_leader = {
								limit = { is_exact_same_species = event_target:non_psionic_species }
								change_species = event_target:psionic_species
								fire_on_action = { on_action = on_leader_species_changed }
							}
						}
					}
				}
			}
		}
		change_dominant_species = { species = event_target:new_main_species_pop.species }
		# TODOL still do traits here, or require other mod?
	}
	option = {
		name = utopia.2650.a
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					}
				}
				every_owned_leader = {
					limit = {
						is_same_species = root
						NOR = {
							has_trait =	leader_trait_admiral_psionic
							has_trait =	leader_trait_general_psionic
							has_trait =	leader_trait_governor_psionic
							has_trait =	leader_trait_scientist_psionic
							has_trait =	leader_trait_ruler_psionic
						}
					}
					if = {
						limit = { leader_class = admiral }
						add_trait = leader_trait_admiral_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = general }
						add_trait = leader_trait_general_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = governor }
						add_trait = leader_trait_governor_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = scientist }
						add_trait = leader_trait_scientist_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = ruler }
						add_trait = leader_trait_ruler_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
				}
				every_pool_leader = {
					limit = {
						is_same_species = root
						#species = {
						#	has_trait = trait_psionic
						#	is_same_value = event_target:psionic_species
						#}
						NOR = {
							has_trait = leader_trait_admiral_psionic
							has_trait = leader_trait_general_psionic
							has_trait = leader_trait_governor_psionic
							has_trait = leader_trait_scientist_psionic
							has_trait = leader_trait_ruler_psionic
						}
					}
					if = {
						limit = { leader_class = admiral }
						add_trait = leader_trait_admiral_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = general }
						add_trait = leader_trait_general_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = governor }
						add_trait = leader_trait_governor_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = scientist }
						add_trait = leader_trait_scientist_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
					if = {
						limit = { leader_class = ruler }
						add_trait = leader_trait_ruler_psionic
						add_ruler_trait = leader_trait_ruler_psionic
					}
				}
			}
			observer_event = { id = observer.6 }
			every_country = {
				limit = {
					is_ai = no
					has_communications = ROOT
					NOT = { is_same_value = ROOT }
				}
				country_event = { id = utopia.2652 }
			}
			country_event = { id = utopia.2655 days = 30 random = 20 }
		}
	}
}