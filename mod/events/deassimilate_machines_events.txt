namespace = deassimilate_machines

# triggered by on_tech_increased or by passthrough deassimilate_machines.3 from on_post_communications_established
country_event = {
	id = deassimilate_machines.1
	is_triggered_only = yes
	title = "deassimilate_machines.1.title"
	desc = "deassimilate_machines.1.desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_robot_encounter
	trigger = {
		has_synthethic_dawn = yes
		NOT = { has_country_flag = deasssimilate_machines_message }
		is_ai = no
		is_regular_empire = yes
		has_ai_and_knows_machines = yes
	}
	immediate = {
		set_country_flag = deasssimilate_machines_message
	}
	option = {
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
			is_xenophobe = no
		}
		name = MARVELOUS
		custom_tooltip = ASSIMILATION_CITIZENSHIP_ENABLED_UNMACHINE
	}
	option = {
		trigger = {
			OR = {
				AND = {
					OR = {
						has_ethic = ethic_xenophobe
						has_ethic = ethic_fanatic_xenophobe
					}
					OR = {
						has_ethic = ethic_materialist
						has_ethic = ethic_fanatic_materialist
					}
				}
				AND = {
					is_xenophobe = no
					is_spiritualist = no
					is_materialist = no
				}
			}
		}
		name = GOOD
		custom_tooltip = ASSIMILATION_CITIZENSHIP_ENABLED_UNMACHINE
	}
	option = {
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
			is_materialist = no
		}
		name = DISCONCERTING
		custom_tooltip = ASSIMILATION_CITIZENSHIP_ENABLED_UNMACHINE
	}
}

# triggered by on_yearly_pulse_country
# intended to trigger after action.64
country_event = {
	id = deassimilate_machines.2
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		num_unique_species > 1
		any_owned_leader = { species = { has_species_flag = assimilation_species_of_empire@root } }
	}
	immediate = {
		every_owned_leader = {
			limit = { species = { has_species_flag = assimilation_species_of_empire@root } }
			fire_on_action = { on_action = on_leader_species_changed }
		}
	}
}

# triggered by on_post_communications_established
country_event = {
	id = deassimilate_machines.3
	is_triggered_only = yes
	hide_window = yes
	trigger = { has_synthethic_dawn = yes }
	immediate = {
		country_event = {
			id = deassimilate_machines.1
		}
		from = {
			country_event = {
				id = deassimilate_machines.1
			}
		}
	}
}