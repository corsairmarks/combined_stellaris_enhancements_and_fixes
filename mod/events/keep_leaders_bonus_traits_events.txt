namespace = keep_leaders_bonus_traits

# trigger on fired/death, when first added, ruler set, ruler back to normal
country_event = {
	id = keep_leaders_bonus_traits.20
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		OR = {
			has_modifier = former_ruler_admin_bonus
			has_modifier = former_heir_admin_bonus
			has_modifier = former_ruler_research_bonus
			has_modifier = former_heir_research_bonus
			has_modifier = former_ruler_naval_bonus
			has_modifier = former_heir_naval_bonus
			any_owned_leader = {
				OR = {
					has_trait = leader_trait_former_ruler_machine_intelligence_governor
					has_trait = leader_trait_former_ruler_machine_intelligence_admiral
					has_trait = leader_trait_former_ruler_machine_intelligence_scientist
					has_trait = leader_trait_former_ruler_hive_governor
					has_trait = leader_trait_former_ruler_hive_admiral
					has_trait = leader_trait_former_ruler_governor
					has_trait = leader_trait_former_ruler_scientist
					has_trait = leader_trait_former_ruler_admiral
					has_trait = leader_trait_former_heir_governor
					has_trait = leader_trait_former_heir_scientist
					has_trait = leader_trait_former_heir_admiral
				}
			}
		}
	}
	immediate = {
		log = "keep_leaders_bonus_traits.20 fired"
		set_update_modifiers_batch = begin
		if = {
			limit = { has_modifier = former_ruler_admin_bonus }
			remove_modifier = former_ruler_admin_bonus
		}
		if = {
			limit = { has_modifier = former_heir_admin_bonus }
			remove_modifier = former_heir_admin_bonus
		}
		if = {
			limit = { has_modifier = former_ruler_research_bonus }
			remove_modifier = former_ruler_research_bonus
		}
		if = {
			limit = { has_modifier = former_heir_research_bonus }
			remove_modifier = former_heir_research_bonus
		}
		if = {
			limit = { has_modifier = former_ruler_naval_bonus }
			remove_modifier = former_ruler_naval_bonus
		}
		if = {
			limit = { has_modifier = former_heir_naval_bonus }
			remove_modifier = former_heir_naval_bonus
		}

		set_variable = {
			which = former_ruler_accumulator_governor
			value = 0
		}
		set_variable = {
			which = former_heir_accumulator_governor
			value = 0
		}
		set_variable = {
			which = former_ruler_accumulator_scientist
			value = 0
		}
		set_variable = {
			which = former_heir_accumulator_scientist
			value = 0
		}
		set_variable = {
			which = former_ruler_accumulator_admiral
			value = 0
		}
		set_variable = {
			which = former_heir_accumulator_admiral
			value = 0
		}
		# set_variable = {
		# 	which = former_ruler_accumulator_general
		# 	value = 0
		# }
		# set_variable = {
		# 	which = former_heir_accumulator_general
		# 	value = 0
		# }

		every_owned_leader = {
			if = {
				limit = {
					leader_class = governor
					OR = {
						has_trait = leader_trait_former_ruler_machine_intelligence_governor
						has_trait = leader_trait_former_ruler_hive_governor
						has_trait = leader_trait_former_ruler_governor
						has_trait = leader_trait_former_heir_governor
					}
				}
				if = {
					limit = { NOT = { has_trait = leader_trait_former_heir_governor } }
					PREV = {
						change_variable = {
							which = former_ruler_accumulator_governor
							value = 1
						}
					}
				}
				else = {
					PREV = {
						change_variable = {
							which = former_heir_accumulator_governor
							value = 1
						}
					}
				}
			}
			else_if = {
				limit = {
					leader_class = scientist
					OR = {
						has_trait = leader_trait_former_ruler_machine_intelligence_scientist
						has_trait = leader_trait_former_ruler_scientist
						has_trait = leader_trait_former_heir_scientist
					}
				}
				if = {
					limit = { NOT = { has_trait = leader_trait_former_heir_scientist } }
					PREV = {
						change_variable = {
							which = former_ruler_accumulator_scientist
							value = 1
						}
					}
				}
				else = {
					PREV = {
						change_variable = {
							which = former_heir_accumulator_scientist
							value = 1
						}
					}
				}
			}
			else_if = {
				limit = {
					leader_class = admiral
					OR = {
						has_trait = leader_trait_former_ruler_machine_intelligence_admiral
						has_trait = leader_trait_former_ruler_hive_admiral
						has_trait = leader_trait_former_ruler_admiral
						has_trait = leader_trait_former_heir_admiral
					}
				}
				if = {
					limit = { NOT = { has_trait = leader_trait_former_heir_admiral } }
					PREV = {
						change_variable = {
							which = former_ruler_accumulator_admiral
							value = 1
						}
					}
				}
				else = {
					PREV = {
						change_variable = {
							which = former_heir_accumulator_admiral
							value = 1
						}
					}
				}
			}
			# else_if = {
			# 	limit = {
			# 		leader_class = general
			# 		OR = {
			# 			has_trait = leader_trait_former_ruler_general
			# 			has_trait = leader_trait_former_heir_general
			# 		}
			# 	}
			# 	if = {
			# 		limit = { NOT = { has_trait = leader_trait_former_heir_general } }
			# 		PREV = {
			# 			change_variable = {
			# 				which = former_ruler_accumulator_general
			# 				value = 1
			# 			}
			# 		}
			# 	}
			# 	else = {
			# 		PREV = {
			# 			change_variable = {
			# 				which = former_heir_accumulator_general
			# 				value = 1
			# 			}
			# 		}
			# 	}
			# }
		}

		if = {
			limit = {
				check_variable = {
					which = former_ruler_accumulator_governor
					value > 0
				}
			}
			add_modifier = {
				modifier = former_ruler_admin_bonus
				multiplier = former_ruler_accumulator_governor
			}
		}

		if = {
			limit = {
				check_variable = {
					which = former_heir_accumulator_governor
					value > 0
				}
			}
			add_modifier = {
				modifier = former_heir_admin_bonus
				multiplier = former_heir_accumulator_governor
			}
		}

		if = {
			limit = {
				check_variable = {
					which = former_ruler_accumulator_scientist
					value > 0
				}
			}
			add_modifier = {
				modifier = former_ruler_research_bonus
				multiplier = former_ruler_accumulator_scientist
			}
		}

		if = {
			limit = {
				check_variable = {
					which = former_heir_accumulator_scientist
					value > 0
				}
			}
			add_modifier = {
				modifier = former_heir_research_bonus
				multiplier = former_heir_accumulator_scientist
			}
		}

		if = {
			limit = {
				check_variable = {
					which = former_ruler_accumulator_admiral
					value > 0
				}
			}
			add_modifier = {
				modifier = former_ruler_naval_bonus
				multiplier = former_ruler_accumulator_admiral
			}
		}

		if = {
			limit = {
				check_variable = {
					which = former_heir_accumulator_admiral
					value > 0
				}
			}
			add_modifier = {
				modifier = former_heir_naval_bonus
				multiplier = former_heir_accumulator_admiral
			}
		}

		clear_variable = former_ruler_accumulator_governor
		clear_variable = former_heir_accumulator_governor
		clear_variable = former_ruler_accumulator_scientist
		clear_variable = former_heir_accumulator_scientist
		clear_variable = former_ruler_accumulator_admiral
		clear_variable = former_heir_accumulator_admiral
		# clear_variable = former_ruler_accumulator_general
		# clear_variable = former_heir_accumulator_general

		set_update_modifiers_batch = end
	}
}

country_event = {
	id = keep_leaders_bonus_traits.21
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		OR = {
			has_modifier = former_ruler_admin_bonus
			has_modifier = former_heir_admin_bonus
			has_modifier = former_ruler_research_bonus
			has_modifier = former_heir_research_bonus
			has_modifier = former_ruler_naval_bonus
			has_modifier = former_heir_naval_bonus
			any_owned_leader = {
				OR = {
					has_trait = leader_trait_former_ruler_machine_intelligence_governor
					has_trait = leader_trait_former_ruler_machine_intelligence_admiral
					has_trait = leader_trait_former_ruler_machine_intelligence_scientist
					has_trait = leader_trait_former_ruler_hive_governor
					has_trait = leader_trait_former_ruler_hive_admiral
					has_trait = leader_trait_former_ruler_governor
					has_trait = leader_trait_former_ruler_scientist
					has_trait = leader_trait_former_ruler_admiral
					has_trait = leader_trait_former_heir_governor
					has_trait = leader_trait_former_heir_scientist
					has_trait = leader_trait_former_heir_admiral
				}
			}
		}
	}
	immediate = {
		country_event = {
			id = keep_leaders_bonus_traits.20
			days = 1
		}
	}
}